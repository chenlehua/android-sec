# Instructions

## 安全启动

请详细介绍车载系统中的secureboot，并进行思维发散，做相关概念的介绍,使用 mermaid 绘制架构、设计、组件、流程等图表并详细说明,保存到./specs/secureboot.md

## docx2md

请将 ./specs目录下的docx转成对用的markdown文档，调整格式，确保内容不丢失


## 后量子密码算法

读取./specs/materials下资料，并联网搜索相关资料，给出后量子密码（PQC）在TEE TA中实施的设计方案，不要有相关代码的描述，使用 mermaid 绘制架构、设计、组件、流程等图表并详细说明,保存到./specs/tee-pqc.md

现状如下：
1.高通平台有QTEE和安全芯片，MTK（yocto、android、TEE、hypervisor）平台只有TEE。
2.safekeyservice：当前native层有常驻服务safekeyservice，向下调用中间件，向上为native层tls通信和应用层tls通信提供能力；native层主要是扩展libcurl支持调用safekeyserivce；应用层扩展Okhttp能力，调framework层SafeKeyManager；framework层封装SafeKeyManager，通过Binder调safekeyservice服务；safekeyservice，还为产线灌装（对称秘钥和证书）提供相关接口。
3.中间件，向上为safekeyservice提供接口，向下调用安全芯片so或者TEE密码模块CA（CA调TA，TA调TEE OS），详细的背景和方案如下

【背景和现状：
1、目前，各厂商提供的HSM（硬件安全模块）和TEE（可信执行环境）接口繁多且各异，为了适配这些接口，通常需要对每个平台单独进行开发和集成，这不仅增加了大量的工作量，还导致了维护和管理上的复杂性。
2、现有的密码模块通常是独立运行的，不具备备份和容错能力，一旦出现失效情况，往往会对业务的正常进行造成较大的影响。
3、为了应对这些挑战，需要开发中间件来统一协调各类HSM和TEE接口。这样不仅可以显著提高系统的可靠性，还能通过提供统一的接口来大幅减少业务适配所需的时间和精力，提高系统的可靠性和管理效率，最终为业务应用提供更加稳健和高效的安全服务支持。

预期收益：
效率提升：由各SE的P11、0018、0016等接口更换为中间件统一API，减少业务的适配和管理上的复杂性，提升效率预计50%。
成本降低：在无HSM、TEE的平台上，可以使用软件密码模块满足海外法规认证、国内市场准入认证，每年降低成本大于100W元（按照Di2.1、Di3.0平台年出货量估算）；
安全性提升：在硬件模块失效的情况下可以无缝切换到TEE、软件密码模块上，不影响业务使用，安全性提升100%。

要求：
1、支持主流的HSM、TEE、软件密码模块通用接口的中间层，方便上层应用统一调用，并对密码设备进行调度管理，提高可靠性。
2、同时支持android和linux系统；在Linux平台，向下兼容安全芯片接口，同时兼容标准GP接口，及PKCS11接口，向上提供基于GMT 0018修改的SDF接口，同时支持openssl 的engine库，供应用方进行双向认证的能力；在Android平台，向下兼容安全芯片接口，兼容标准GP接口，及PKCS11接口。向上提供基于GMT 0018修改的SDF接口，应用方会通过指定套件的方式调用SDF接口进行双向认证。
3、外部接口，对于密码管理接口，参考GMT 0018进行标准化接口设计；对于linux下双向https接口，参考openssl engine的方式进行设计；
4、信息安全中间件为证书管理、数据解密、数据存储、密钥运算等提供密钥的集中管理，支持RSA、AES等密钥的安全保护，证书的存取，自定义数据存取等。
5、可靠存储
	应尽可能提供安全可信环境进行存储，安全可信环境包括但不限于HSM/TEE/SE等
6、数据加密
若设备具备安全可信环境，则应提供多层密钥结构进行数据的安全存储，使用安全可信环境的密钥加密密钥对数据进行加密存储。
7、密码运算
a)支持RSA2048\ECC\AES128\AES256\SHA256\SHA256-HMAC等国际通用算法；
b)AES算法模式至少支持ECB/CBC/GCM
c)国内车型扩展支持国密SM2/SM4/SM3
d)SM4算法模式至少支持ECB/CBC
8、隔离运算
长期密钥在生命周期内不可出安全存储区，以防泄露。
】

4.TEE密码模块背景和实现如下
【基于不同TEE OS，例如Trustonic、Optee OS的TEE密码模块,开发CA/TA
背景：R155、GB/T32960、GB44495、汽车密码应用技术等法规均要求对重要数据和密钥做出要求，需要保存在经过权威机构认证的安全芯片或密码模块中。
现状：1、密钥明文存储，业务明文读取，存在密钥泄露、合规风险
2、使用单独的分区管理密钥，密钥在设备中密文存储，但使用是业务解密后使用，存在密钥泄露、合规风险；
3、使用HSM存储密钥，密钥在安全芯片中生成、使用、销毁，生命周期内不出安全区，HSM经过EAL5+认证，满足合规要求，安全芯片上车后经过数年的使用，逐渐暴露了一些问题：稳定性较差，芯片厂商经常要更换芯片SDK，产商经营问题导致可能存在供应链安全，导入和开发适配周期很长。
4、TEE相比传统安全芯片具有更高的性能、更低的单车成本以及更强的适应能力，尤其在多系统架构支持与现有产业链中的量产验证方面更具优势。未来在智能设备、汽车领域中，TEE或将成为安全解决方案的关键驱动力。
5、安全芯片占用多媒体主机的USB接口，并且只能挂载在单个系统上，另外一个系统需要通过转发服务进行调用，调用链条加长，容易产生风险；SOC使用多个操作系统时，多个操作系统通过hypervison直通TEE进行通讯，无需进行跨域通信调度，可靠性高、性能高，TEE先于操作系统启动，准备时间忽略不计；

要求：
1、应用场景：生物认证、安全启动、安全存储、密钥管理、安全通信、安全 OTA
2、CA及TEEos、CA/TA间接口规范参考02-GPD_TEE_Internal_Core_API_Specification和01-TEE_Client_API_Specification，对业务侧的接口规范参考GMT 0016、GMT 0018
3、安全存储采用SFS、RPMB等
4、研发环境采用optee4.1.0 qemu编译环境搭建
5、设计一套CA/TA间的数据传输协议，参考《CATA APDU传输协议规范》实现；
6、功能包括设备管理、回话管理、授权管理、秘钥管理、密码服务、安全存储、证书管理、日志管理等。
7、日志管理：
○对重要信息生成日志进行存储，并对日志进行管理；
○重要信息包含调用者的数据输入过程、结果输出过程等关键环节的错误信息、调用者权限管理、访问控制管理等敏感内容；
○日志应支持等级控制；
8、证书管理：生成证书请求，格式符合RFC 2986
9、安全存储：
○应对外提供安全文件的创建、读、写、删除等功能；
○在进行数据读取和写入时， 应建立安全通道和数据保护机制，确保数据的机密性和完整性；
○应在读、写、创建、删除前进行鉴别和授权；
○不同TA的加密密钥应不同，防止TA之间的水平越权访问；
○安全存储区应采用防御技术保证其不被非法获取和篡改。

10、密钥服务○RSA2048/ECC/SM2签名验签
○RSA2048/ECC/SM2加密解密
○AES128/AES192/AES256/SM4加密解密，至少支持ECB/CBC模式
○支持MD5/SM3/SHA256
○支持AES128/AES192/AES256/SM4 CMAC算法
○宜支持SHA256HMAC算法
○宜支持KDF算法
○宜具备密钥协商功能

11、密钥管理
○密钥创建：创建对称/非对称密钥，可根据实际情况进行落盘或导出。
○密钥导入：应具备密钥明文和密钥密文的导入功能，如向TEE内导入业务密钥等，并确保密钥导入的安全性
○应具备密钥的访问控制功能，在密钥生成或导入时，密钥使用方应为密钥指定其被授权使用的方式或目的，包括但不限于加密、解密、签名、身份验证等。在密钥使用时，由TEE执行授权校验，避免密钥被未经授权的方式使用。
○应支持非对称密码算法的公钥及证书从TEE中导出的功能，确保其他类密钥的明文不出TEE，不应支持私钥的导出功能。
○密钥获取：获取已落盘的密钥的信息，其中，对称密钥和非对称密钥的私钥无法导出。

12、授权管理
○初始化：提供对设备进行初始化功能，初始化之前密钥管理、密钥服务、文件管理、证书管理等功能均不可用。此功能只应出现在产测版本，不应在SOP版本提供此功能。
○具备身份信息写入与身份信息存储功能；
○用户身份信息应被安全的存储在RMPB或安全存储区中，并提供身份信息防泄露机制；
○身份信息的注册与校验过程应在TEE内部进行，确保注册与校验过程的安全性，并提供防暴力破解机制，包括但不限于设置错误验证次数阈值、基于时间惩罚的验证锁定等；
○宜提供达到错误验证次数阈值后的身份信息删除功能，以防止恶意攻击。


13、会话管理
○打开、关闭会话，可多次打开关闭，支持多进程多线程

14、设备管理
○打开、关闭设备，可多次打开关闭，支持多进程多线程
○获取设备SN等硬件信息，设备SN每个设备唯一，由4位型号标识符和自定义12位标识符组成。
○获取密码模块软件版本号，每次升级变更
○版本升级，宜支持AB升级，应具备防止版本回退功能】


##  TEE与安全芯片的日志审计与异常关联分析

读取./specs/materials下资料，并联网搜索相关资料，给出TEE与安全芯片的日志审计与异常关联分析的设计方案，不要有相关代码的描述，使用 mermaid 绘制架构、设计、组件、流程等图表并详细说明,保存到./specs/sec-log-analysis.md

现状如下：
1.高通平台有QTEE和安全芯片，MTK（yocto、android、TEE、hypervisor）平台只有TEE。
2.safekeyservice：当前native层有常驻服务safekeyservice，向下调用中间件，向上为native层tls通信和应用层tls通信提供能力；native层主要是扩展libcurl支持调用safekeyserivce；应用层扩展Okhttp能力，调framework层SafeKeyManager；framework层封装SafeKeyManager，通过Binder调safekeyservice服务；safekeyservice，还为产线灌装（对称秘钥和证书）提供相关接口。
3.中间件，向上为safekeyservice提供接口，向下调用安全芯片so或者TEE密码模块CA（CA调TA，TA调TEE OS），详细的背景和方案如下

【背景和现状：
1、目前，各厂商提供的HSM（硬件安全模块）和TEE（可信执行环境）接口繁多且各异，为了适配这些接口，通常需要对每个平台单独进行开发和集成，这不仅增加了大量的工作量，还导致了维护和管理上的复杂性。
2、现有的密码模块通常是独立运行的，不具备备份和容错能力，一旦出现失效情况，往往会对业务的正常进行造成较大的影响。
3、为了应对这些挑战，需要开发中间件来统一协调各类HSM和TEE接口。这样不仅可以显著提高系统的可靠性，还能通过提供统一的接口来大幅减少业务适配所需的时间和精力，提高系统的可靠性和管理效率，最终为业务应用提供更加稳健和高效的安全服务支持。

预期收益：
效率提升：由各SE的P11、0018、0016等接口更换为中间件统一API，减少业务的适配和管理上的复杂性，提升效率预计50%。
成本降低：在无HSM、TEE的平台上，可以使用软件密码模块满足海外法规认证、国内市场准入认证，每年降低成本大于100W元（按照Di2.1、Di3.0平台年出货量估算）；
安全性提升：在硬件模块失效的情况下可以无缝切换到TEE、软件密码模块上，不影响业务使用，安全性提升100%。

要求：
1、支持主流的HSM、TEE、软件密码模块通用接口的中间层，方便上层应用统一调用，并对密码设备进行调度管理，提高可靠性。
2、同时支持android和linux系统；在Linux平台，向下兼容安全芯片接口，同时兼容标准GP接口，及PKCS11接口，向上提供基于GMT 0018修改的SDF接口，同时支持openssl 的engine库，供应用方进行双向认证的能力；在Android平台，向下兼容安全芯片接口，兼容标准GP接口，及PKCS11接口。向上提供基于GMT 0018修改的SDF接口，应用方会通过指定套件的方式调用SDF接口进行双向认证。
3、外部接口，对于密码管理接口，参考GMT 0018进行标准化接口设计；对于linux下双向https接口，参考openssl engine的方式进行设计；
4、信息安全中间件为证书管理、数据解密、数据存储、密钥运算等提供密钥的集中管理，支持RSA、AES等密钥的安全保护，证书的存取，自定义数据存取等。
5、可靠存储
	应尽可能提供安全可信环境进行存储，安全可信环境包括但不限于HSM/TEE/SE等
6、数据加密
若设备具备安全可信环境，则应提供多层密钥结构进行数据的安全存储，使用安全可信环境的密钥加密密钥对数据进行加密存储。
7、密码运算
a)支持RSA2048\ECC\AES128\AES256\SHA256\SHA256-HMAC等国际通用算法；
b)AES算法模式至少支持ECB/CBC/GCM
c)国内车型扩展支持国密SM2/SM4/SM3
d)SM4算法模式至少支持ECB/CBC
8、隔离运算
长期密钥在生命周期内不可出安全存储区，以防泄露。
】

4.TEE密码模块背景和实现如下
【基于不同TEE OS，例如Trustonic、Optee OS的TEE密码模块,开发CA/TA
背景：R155、GB/T32960、GB44495、汽车密码应用技术等法规均要求对重要数据和密钥做出要求，需要保存在经过权威机构认证的安全芯片或密码模块中。
现状：1、密钥明文存储，业务明文读取，存在密钥泄露、合规风险
2、使用单独的分区管理密钥，密钥在设备中密文存储，但使用是业务解密后使用，存在密钥泄露、合规风险；
3、使用HSM存储密钥，密钥在安全芯片中生成、使用、销毁，生命周期内不出安全区，HSM经过EAL5+认证，满足合规要求，安全芯片上车后经过数年的使用，逐渐暴露了一些问题：稳定性较差，芯片厂商经常要更换芯片SDK，产商经营问题导致可能存在供应链安全，导入和开发适配周期很长。
4、TEE相比传统安全芯片具有更高的性能、更低的单车成本以及更强的适应能力，尤其在多系统架构支持与现有产业链中的量产验证方面更具优势。未来在智能设备、汽车领域中，TEE或将成为安全解决方案的关键驱动力。
5、安全芯片占用多媒体主机的USB接口，并且只能挂载在单个系统上，另外一个系统需要通过转发服务进行调用，调用链条加长，容易产生风险；SOC使用多个操作系统时，多个操作系统通过hypervison直通TEE进行通讯，无需进行跨域通信调度，可靠性高、性能高，TEE先于操作系统启动，准备时间忽略不计；

要求：
1、应用场景：生物认证、安全启动、安全存储、密钥管理、安全通信、安全 OTA
2、CA及TEEos、CA/TA间接口规范参考02-GPD_TEE_Internal_Core_API_Specification和01-TEE_Client_API_Specification，对业务侧的接口规范参考GMT 0016、GMT 0018
3、安全存储采用SFS、RPMB等
4、研发环境采用optee4.1.0 qemu编译环境搭建
5、设计一套CA/TA间的数据传输协议，参考《CATA APDU传输协议规范》实现；
6、功能包括设备管理、回话管理、授权管理、秘钥管理、密码服务、安全存储、证书管理、日志管理等。
7、日志管理：
○对重要信息生成日志进行存储，并对日志进行管理；
○重要信息包含调用者的数据输入过程、结果输出过程等关键环节的错误信息、调用者权限管理、访问控制管理等敏感内容；
○日志应支持等级控制；
8、证书管理：生成证书请求，格式符合RFC 2986
9、安全存储：
○应对外提供安全文件的创建、读、写、删除等功能；
○在进行数据读取和写入时， 应建立安全通道和数据保护机制，确保数据的机密性和完整性；
○应在读、写、创建、删除前进行鉴别和授权；
○不同TA的加密密钥应不同，防止TA之间的水平越权访问；
○安全存储区应采用防御技术保证其不被非法获取和篡改。

10、密钥服务○RSA2048/ECC/SM2签名验签
○RSA2048/ECC/SM2加密解密
○AES128/AES192/AES256/SM4加密解密，至少支持ECB/CBC模式
○支持MD5/SM3/SHA256
○支持AES128/AES192/AES256/SM4 CMAC算法
○宜支持SHA256HMAC算法
○宜支持KDF算法
○宜具备密钥协商功能

11、密钥管理
○密钥创建：创建对称/非对称密钥，可根据实际情况进行落盘或导出。
○密钥导入：应具备密钥明文和密钥密文的导入功能，如向TEE内导入业务密钥等，并确保密钥导入的安全性
○应具备密钥的访问控制功能，在密钥生成或导入时，密钥使用方应为密钥指定其被授权使用的方式或目的，包括但不限于加密、解密、签名、身份验证等。在密钥使用时，由TEE执行授权校验，避免密钥被未经授权的方式使用。
○应支持非对称密码算法的公钥及证书从TEE中导出的功能，确保其他类密钥的明文不出TEE，不应支持私钥的导出功能。
○密钥获取：获取已落盘的密钥的信息，其中，对称密钥和非对称密钥的私钥无法导出。

12、授权管理
○初始化：提供对设备进行初始化功能，初始化之前密钥管理、密钥服务、文件管理、证书管理等功能均不可用。此功能只应出现在产测版本，不应在SOP版本提供此功能。
○具备身份信息写入与身份信息存储功能；
○用户身份信息应被安全的存储在RMPB或安全存储区中，并提供身份信息防泄露机制；
○身份信息的注册与校验过程应在TEE内部进行，确保注册与校验过程的安全性，并提供防暴力破解机制，包括但不限于设置错误验证次数阈值、基于时间惩罚的验证锁定等；
○宜提供达到错误验证次数阈值后的身份信息删除功能，以防止恶意攻击。


13、会话管理
○打开、关闭会话，可多次打开关闭，支持多进程多线程

14、设备管理
○打开、关闭设备，可多次打开关闭，支持多进程多线程
○获取设备SN等硬件信息，设备SN每个设备唯一，由4位型号标识符和自定义12位标识符组成。
○获取密码模块软件版本号，每次升级变更
○版本升级，宜支持AB升级，应具备防止版本回退功能】


##  RPMB安全存储单点问题与优化

读取./specs/materials下资料，并联网搜索相关资料，给出RPMB安全存储单点问题与优化的设计方案，不要有相关代码的描述，使用 mermaid 绘制架构、设计、组件、流程等图表并详细说明,保存到./specs/rpmb-single-point.md

现状如下：
1.高通平台有QTEE和安全芯片，MTK（yocto、android、TEE、hypervisor）平台只有TEE。
2.safekeyservice：当前native层有常驻服务safekeyservice，向下调用中间件，向上为native层tls通信和应用层tls通信提供能力；native层主要是扩展libcurl支持调用safekeyserivce；应用层扩展Okhttp能力，调framework层SafeKeyManager；framework层封装SafeKeyManager，通过Binder调safekeyservice服务；safekeyservice，还为产线灌装（对称秘钥和证书）提供相关接口。
3.中间件，向上为safekeyservice提供接口，向下调用安全芯片so或者TEE密码模块CA（CA调TA，TA调TEE OS），详细的背景和方案如下

【背景和现状：
1、目前，各厂商提供的HSM（硬件安全模块）和TEE（可信执行环境）接口繁多且各异，为了适配这些接口，通常需要对每个平台单独进行开发和集成，这不仅增加了大量的工作量，还导致了维护和管理上的复杂性。
2、现有的密码模块通常是独立运行的，不具备备份和容错能力，一旦出现失效情况，往往会对业务的正常进行造成较大的影响。
3、为了应对这些挑战，需要开发中间件来统一协调各类HSM和TEE接口。这样不仅可以显著提高系统的可靠性，还能通过提供统一的接口来大幅减少业务适配所需的时间和精力，提高系统的可靠性和管理效率，最终为业务应用提供更加稳健和高效的安全服务支持。

预期收益：
效率提升：由各SE的P11、0018、0016等接口更换为中间件统一API，减少业务的适配和管理上的复杂性，提升效率预计50%。
成本降低：在无HSM、TEE的平台上，可以使用软件密码模块满足海外法规认证、国内市场准入认证，每年降低成本大于100W元（按照Di2.1、Di3.0平台年出货量估算）；
安全性提升：在硬件模块失效的情况下可以无缝切换到TEE、软件密码模块上，不影响业务使用，安全性提升100%。

要求：
1、支持主流的HSM、TEE、软件密码模块通用接口的中间层，方便上层应用统一调用，并对密码设备进行调度管理，提高可靠性。
2、同时支持android和linux系统；在Linux平台，向下兼容安全芯片接口，同时兼容标准GP接口，及PKCS11接口，向上提供基于GMT 0018修改的SDF接口，同时支持openssl 的engine库，供应用方进行双向认证的能力；在Android平台，向下兼容安全芯片接口，兼容标准GP接口，及PKCS11接口。向上提供基于GMT 0018修改的SDF接口，应用方会通过指定套件的方式调用SDF接口进行双向认证。
3、外部接口，对于密码管理接口，参考GMT 0018进行标准化接口设计；对于linux下双向https接口，参考openssl engine的方式进行设计；
4、信息安全中间件为证书管理、数据解密、数据存储、密钥运算等提供密钥的集中管理，支持RSA、AES等密钥的安全保护，证书的存取，自定义数据存取等。
5、可靠存储
	应尽可能提供安全可信环境进行存储，安全可信环境包括但不限于HSM/TEE/SE等
6、数据加密
若设备具备安全可信环境，则应提供多层密钥结构进行数据的安全存储，使用安全可信环境的密钥加密密钥对数据进行加密存储。
7、密码运算
a)支持RSA2048\ECC\AES128\AES256\SHA256\SHA256-HMAC等国际通用算法；
b)AES算法模式至少支持ECB/CBC/GCM
c)国内车型扩展支持国密SM2/SM4/SM3
d)SM4算法模式至少支持ECB/CBC
8、隔离运算
长期密钥在生命周期内不可出安全存储区，以防泄露。
】

4.TEE密码模块背景和实现如下
【基于不同TEE OS，例如Trustonic、Optee OS的TEE密码模块,开发CA/TA
背景：R155、GB/T32960、GB44495、汽车密码应用技术等法规均要求对重要数据和密钥做出要求，需要保存在经过权威机构认证的安全芯片或密码模块中。
现状：1、密钥明文存储，业务明文读取，存在密钥泄露、合规风险
2、使用单独的分区管理密钥，密钥在设备中密文存储，但使用是业务解密后使用，存在密钥泄露、合规风险；
3、使用HSM存储密钥，密钥在安全芯片中生成、使用、销毁，生命周期内不出安全区，HSM经过EAL5+认证，满足合规要求，安全芯片上车后经过数年的使用，逐渐暴露了一些问题：稳定性较差，芯片厂商经常要更换芯片SDK，产商经营问题导致可能存在供应链安全，导入和开发适配周期很长。
4、TEE相比传统安全芯片具有更高的性能、更低的单车成本以及更强的适应能力，尤其在多系统架构支持与现有产业链中的量产验证方面更具优势。未来在智能设备、汽车领域中，TEE或将成为安全解决方案的关键驱动力。
5、安全芯片占用多媒体主机的USB接口，并且只能挂载在单个系统上，另外一个系统需要通过转发服务进行调用，调用链条加长，容易产生风险；SOC使用多个操作系统时，多个操作系统通过hypervison直通TEE进行通讯，无需进行跨域通信调度，可靠性高、性能高，TEE先于操作系统启动，准备时间忽略不计；

要求：
1、应用场景：生物认证、安全启动、安全存储、密钥管理、安全通信、安全 OTA
2、CA及TEEos、CA/TA间接口规范参考02-GPD_TEE_Internal_Core_API_Specification和01-TEE_Client_API_Specification，对业务侧的接口规范参考GMT 0016、GMT 0018
3、安全存储采用SFS、RPMB等
4、研发环境采用optee4.1.0 qemu编译环境搭建
5、设计一套CA/TA间的数据传输协议，参考《CATA APDU传输协议规范》实现；
6、功能包括设备管理、回话管理、授权管理、秘钥管理、密码服务、安全存储、证书管理、日志管理等。
7、日志管理：
○对重要信息生成日志进行存储，并对日志进行管理；
○重要信息包含调用者的数据输入过程、结果输出过程等关键环节的错误信息、调用者权限管理、访问控制管理等敏感内容；
○日志应支持等级控制；
8、证书管理：生成证书请求，格式符合RFC 2986
9、安全存储：
○应对外提供安全文件的创建、读、写、删除等功能；
○在进行数据读取和写入时， 应建立安全通道和数据保护机制，确保数据的机密性和完整性；
○应在读、写、创建、删除前进行鉴别和授权；
○不同TA的加密密钥应不同，防止TA之间的水平越权访问；
○安全存储区应采用防御技术保证其不被非法获取和篡改。

10、密钥服务○RSA2048/ECC/SM2签名验签
○RSA2048/ECC/SM2加密解密
○AES128/AES192/AES256/SM4加密解密，至少支持ECB/CBC模式
○支持MD5/SM3/SHA256
○支持AES128/AES192/AES256/SM4 CMAC算法
○宜支持SHA256HMAC算法
○宜支持KDF算法
○宜具备密钥协商功能

11、密钥管理
○密钥创建：创建对称/非对称密钥，可根据实际情况进行落盘或导出。
○密钥导入：应具备密钥明文和密钥密文的导入功能，如向TEE内导入业务密钥等，并确保密钥导入的安全性
○应具备密钥的访问控制功能，在密钥生成或导入时，密钥使用方应为密钥指定其被授权使用的方式或目的，包括但不限于加密、解密、签名、身份验证等。在密钥使用时，由TEE执行授权校验，避免密钥被未经授权的方式使用。
○应支持非对称密码算法的公钥及证书从TEE中导出的功能，确保其他类密钥的明文不出TEE，不应支持私钥的导出功能。
○密钥获取：获取已落盘的密钥的信息，其中，对称密钥和非对称密钥的私钥无法导出。

12、授权管理
○初始化：提供对设备进行初始化功能，初始化之前密钥管理、密钥服务、文件管理、证书管理等功能均不可用。此功能只应出现在产测版本，不应在SOP版本提供此功能。
○具备身份信息写入与身份信息存储功能；
○用户身份信息应被安全的存储在RMPB或安全存储区中，并提供身份信息防泄露机制；
○身份信息的注册与校验过程应在TEE内部进行，确保注册与校验过程的安全性，并提供防暴力破解机制，包括但不限于设置错误验证次数阈值、基于时间惩罚的验证锁定等；
○宜提供达到错误验证次数阈值后的身份信息删除功能，以防止恶意攻击。


13、会话管理
○打开、关闭会话，可多次打开关闭，支持多进程多线程

14、设备管理
○打开、关闭设备，可多次打开关闭，支持多进程多线程
○获取设备SN等硬件信息，设备SN每个设备唯一，由4位型号标识符和自定义12位标识符组成。
○获取密码模块软件版本号，每次升级变更
○版本升级，宜支持AB升级，应具备防止版本回退功能】


## TEE与安全芯片的日志审计与异常关联分析优化

1、整体架构中SafeKeyManager位于Framework层，safekeyservice、密码中间件位于native层
2、联网考虑如下方面的可行性，可能的话更新文档
	TEE日志监控（TZDiag）：TEE内核会输出调试与错误日志到/proc/tzdbg 。I应实时解析这些日志。
攻击特征：频繁出现的错误码0x3（Access Denied）或0xFFFF0003可能表明REE侧的恶意内核模块正在尝试非法映射安全内存区域，这是典型的提权攻击前兆。
侧信道探测：如果在短时间内出现大量的解密失败记录，可能意味着攻击者正在进行Bleichenbacher Oracle攻击或基于时间的侧信道分析。
   应用层TLS通信异常通常对应底层，safekeyservice/中间件/TEE CA、TA的错误，关联分析：如果IDS检测到网络流量中有异常的入站连接，同时抛出大量的“密钥未认证”或“硬件忙”错误，这极有可能是针对车联网服务的拒绝服务（DoS）攻击，试图耗尽SE/TEE资源。
7.2 响应机制与合规报告
一旦检测到上述异常，应触发防御机制：
降级熔断：暂时锁定SE的高级功能，强制系统回退到TEE备份模式，并限制密钥生成的频率。
取证记录：将相关的TZDiag日志片段、内核堆栈信息加密打包存储至防篡改的SFS区域，以满足R155对于取证能力的要求。
合规上报：根据GB 32960.2的要求，将严重安全事件（如信任根受攻击）上报至车企安全运营中心（VSOC）。


## 后量子密码算法优化

当前