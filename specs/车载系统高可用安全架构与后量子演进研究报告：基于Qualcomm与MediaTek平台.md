# **车载系统高可用安全架构与后量子演进研究报告：基于Qualcomm与MediaTek平台**

## **1. 执行摘要**

随着软件定义汽车（SDV）架构的普及，车载电子系统的安全性已成为功能安全与隐私保护的基石。当前的汽车安全架构普遍依赖于硬件信任根，即安全启动（Secure
Boot）、可信执行环境（TEE, Trusted Execution
Environment）以及安全单元（SE, Secure
Element）。然而，面对日益复杂的攻击手段和供应链风险，传统的静态防御架构显现出脆弱性：SE硬件故障可能导致车辆关键功能瘫痪；量子计算的进步威胁着现有的非对称加密体系；孤立的日志系统无法有效检测复杂的跨域攻击；而特定平台（如MediaTek）的RPMB（Replay
Protected Memory Block）单点故障问题更是严重影响了系统的可靠性。

本报告针对Qualcomm（QTEE/QSEE）和MediaTek（Kinibi/TEE）平台，深入分析并提出了一套高可用、可审计且具备后量子抗性的车载安全架构方案。报告核心涵盖四大技术支柱：第一，设计兼容国密SDF接口与国际PKCS#11接口的**弹性密码中间件（Resilient
Cryptographic Middleware,
RCM）**，利用"熔断器模式"实现SE故障时向TEE的毫秒级无缝切换，确保业务连续性；第二，基于**wolfSSL**与**ARM
NEON**指令集优化，在TEE可信应用（TA）中部署**Kyber-512**与**Dilithium-2**算法，构建不依赖白盒密码的硬件隔离级后量子防御；第三，建立**TEE与SE统一审计架构**，通过共享内存环形缓冲区与哈希链技术，实现符合GB
44495要求的防篡改日志关联分析；第四，针对MediaTek平台提出\*\*混合存储镜像（Hybrid
Storage
Mirroring）\*\*机制，结合REE文件系统加密备份与云端仲裁，彻底解决RPMB单点故障风险。

本方案严格遵循**GB/T 32960.2-2025**关于数据一致性与重传的要求、**GB
44495**关于车辆网络安全技术的要求，以及**UN
R155**关于网络安全管理体系（CSMS）的合规性规定，旨在为2026年及以后的车型提供具有前瞻性的安全技术参考。

## **2. 合规性需求与技术映射分析**

在设计高可用安全架构之前，必须精准解析相关标准对密码学实现、故障恢复及审计能力的具体约束。这些法规不仅是市场准入的门槛，更是技术架构设计的核心输入。

### **2.1 GB/T 32960.2-2025：电动汽车远程服务与管理系统技术规范**

该标准作为强制性国标GB
32960的修订版本，对车载终端的数据采集、存储与传输提出了更高的要求，直接影响底层安全存储与通信协议的设计
。

-   **通信故障下的数据补发与存储完整性**：
    > 标准第4.2.5条明确规定，在通信故障期间，车载终端必须将采集的实时数据存储在本地介质中，并在通信恢复后进行补发
    > 。这对安全架构提出了双重挑战：

    1.  **存储的机密性与防篡改性**：本地缓存的数据包含车辆轨迹、电池状态等敏感信息，必须加密存储。如果系统仅依赖SE进行加密，一旦SE在通信故障期间失效，将导致数据明文落地或无法写入。因此，架构中必须包含TEE作为备用的加密引擎，确保在"断网+SE故障"的最恶劣工况下，数据依然受到保护。

    2.  **时间戳的可信度**：标准第5.1.2条要求数据时间与标准时间的误差不超过±5秒
        > 。在SE失效切换至TEE的过程中，必须保证可信时间源（Secure
        > RTC）的同步，防止因时间篡改导致的数据包被平台拒收或重放攻击检测失效。

### **2.2 GB 44495-2024：汽车整车信息安全技术要求**

作为中国汽车网络安全的顶层强制标准，GB
44495对车辆的全生命周期安全提出了具体技术要求 。

-   **关键数据存储安全**：\
    > 标准要求对车辆密钥、证书及敏感个人信息进行安全存储。虽然SE提供了最高等级的物理防护，但单点依赖不符合系统工程中的"弹性"原则。本报告提出的\*\*TEE加密文件系统（EFS）\*\*作为SE的二级备份，利用TrustZone的隔离特性，在满足"安全存储"合规要求的同时，提供了SE无法具备的灾备能力。

-   **安全事件记录与分析**：\
    > 标准强制要求车辆具备检测和记录网络安全事件的能力。目前的痛点在于TEE和SE往往是"黑盒"，其内部异常（如验签失败、复位次数过多）极少透传给应用层。本报告设计的**统一日志审计架构**（详见第6章）正是为了满足此项要求，通过将底层的硬件异常转化为标准化的安全事件（Security
    > Events），供车载IDS（入侵检测系统）分析。

### **2.3 UN R155 与 ISO/SAE 21434：网络安全管理体系**

UN
R155法规要求OEM厂商必须证明其具备管理网络安全风险的能力，特别是针对供应链风险和后量子时代的长期安全风险
。

-   **风险处置与缓解**：\
    > ISO/SAE
    > 21434要求对识别出的风险（如密钥泄露、硬件故障）进行处置。SE失效导致的车辆无法启动（Immobilizer故障）属于高严重度风险。通过**中间件仲裁机制**实现SE到TEE的故障转移，是降低该风险"危害性（Impact）"和"可能性（Likelihood）"的有效技术手段。

-   **加密敏捷性（Crypto Agility）**：
    > 虽然R155未直接点名后量子密码（PQC），但要求车辆在全生命周期内（通常10-15年）抵抗网络威胁。随着量子计算的发展，现有的ECC/RSA算法将在车辆报废前变得不安全。NIST发布的PQC标准化路线图
    > 表明，基于软件（TEE
    > TA）的加密实现比固化的硬件（SE）更具灵活性，能够通过OTA升级支持Kyber和Dilithium等新算法，这是满足R155长期合规性的关键策略。

## **3. 车载系统安全架构现状与挑战**

Qualcomm和MediaTek作为主流的车载SoC供应商，在安全架构的设计理念上既有共性也存在显著差异。理解这些差异是设计通用中间件的前提。

### **3.1 Qualcomm平台架构（QTEE/QSEE）**

Qualcomm平台通常采用QSEE（Qualcomm Secure Execution
Environment）作为TEE实现。

-   **硬件基础**：基于ARM TrustZone，通过Secure Boot Chain引导QSEE OS。

-   **安全单元（SE）集成**：Qualcomm平台常配备SPU（Secure Processing
    > Unit）或集成的eSE。这些单元通过专有总线与SoC通信，具有独立的RAM和ROM。

-   **存储架构**：深度依赖RPMB进行防回滚计数器（Anti-Rollback
    > Counter）的存储。QSEE提供了SFS（Secure File
    > System）API，底层通过加密写入RPMB或UFS的专用分区。

-   **痛点**：QSEE的封闭性较强，OEM难以深度定制底层的故障恢复逻辑；SPU与主核之间的通信若发生总线挂死，会导致整个安全服务不可用。

### **3.2 MediaTek平台架构（Kinibi/TEE）**

MediaTek平台广泛采用Trustonic的Kinibi OS或自研TEE。

-   **微内核架构**：Kinibi采用微内核设计，驱动程序（Drivers）和可信应用（TAs）运行在用户空间，具有较好的故障隔离性
    > 。

-   **RPMB依赖性**：MTK平台对RPMB的依赖极高，甚至某些Bootloader阶段的配置都存储于此。然而，在实际量产中，eMMC/UFS的RPMB分区因读写寿命或控制器Bug导致失效的案例时有发生，这在MTK平台上极易导致"变砖"
    > 。

-   **SE集成**：通常通过SPI/I2C外挂第三方SE（如NXP、ST）。这种松耦合架构导致通信链路更容易受到电磁干扰或物理攻击，增加了中间件进行链路仲裁的必要性。

### **3.3 共同挑战：白盒密码的局限性**

在缺乏硬件SE或SE失效时，传统做法是使用白盒密码（White-Box
Cryptography）在REE（Android/Linux）侧保护密钥。然而，白盒密码存在严重的性能瓶颈和安全隐患：

-   **性能**：白盒实现的AES/RSA通常比标准实现慢10-100倍，无法满足车内实时通信（如CAN
    > FD加密）的需求。

-   **安全性**：侧信道攻击（DPA/SPA）和故障注入攻击（DCA）可以有效破解白盒密钥。GB
    > 44495明确要求密钥不应明文出现在非安全内存中。

-   **结论**：本报告坚决摒弃白盒密码方案，主张利用TEE作为SE的"热备份"，利用TrustZone的硬件隔离特性提供接近SE的安全等级，同时保持软件的灵活性。

## **4. 弹性密码中间件：兼容备份与仲裁设计**

为了解决SE单点故障问题，我们设计了一套运行在REE（Rich Execution
Environment）侧的**弹性密码中间件（Resilient Cryptographic Middleware,
RCM）**。该中间件位于应用层与底层驱动之间，负责屏蔽硬件差异，并在SE失效时透明地将流量切换至TEE。

### **4.1 总体架构设计**

RCM采用分层模块化设计，向下适配不同的硬件接口（SE Driver, TEE Client
API），向上提供标准化的密码服务接口。

  ---------------------------------------------------------------------------------------------------
  **层级**         **模块名称**      **功能描述**
  ---------------- ----------------- ----------------------------------------------------------------
  **应用接口层**   **SDF Wrapper     封装国密接口（GM/T 0018），提供SDF_OpenDevice,
                   (GB)**            SDF_Encrypt等标准调用 。

                   **PKCS#11         提供国际通用接口，适配Android Keystore和AutoSAR Crypto Stack 。
                   Provider**        

  **核心逻辑层**   **仲裁控制器      基于状态机（FSM）管理当前活跃的密码后端（Primary/Secondary）。
                   (Arbiter)**       

                   **熔断器 (Circuit 监控SE健康状态，执行故障计数、熔断与半开探测逻辑 。
                   Breaker)**        

                   **密钥映射表 (Key 维护逻辑密钥ID到物理存储位置（SE Slot / TEE Object）的映射关系。
                   Map)**            

  **适配器层**     **SE Adapter**    通过ISO 7816 APDU或SPI协议与物理SE通信。

                   **TEE Adapter**   通过TEEC_InvokeCommand与TEE中的虚拟SE TA通信 。
  ---------------------------------------------------------------------------------------------------

### **4.2 故障仲裁与熔断机制 (Circuit Breaker Pattern)**

在嵌入式系统中，盲目重试故障设备会导致系统卡顿甚至看门狗复位。RCM引入微服务架构中常见的"熔断器模式"，针对车载环境进行了实时性改造。

#### **4.2.1 状态机定义**

RCM内部维护一个有限状态机（FSM），包含以下状态：

1.  **CLOSED（正常态）**：

    -   所有密码请求路由至SE Adapter。

    -   监控SE返回码。若返回 SW_SUCCESS (9000)，重置错误计数器。

    -   若捕获硬件级错误（如 I2C_TIMEOUT, SPI_CRC_ERROR,
        > CKR_DEVICE_REMOVED ），错误计数器加1。

2.  **OPEN（熔断态）**：

    -   触发条件：错误计数器在TIME_WINDOW（如1秒）内超过THRESHOLD（如3次）。

    -   行为：立即停止向SE发送请求。将当前及后续请求重路由至**TEE
        > Adapter**。

    -   **日志记录**：向审计守护进程发送"SE熔断"高危事件 。

    -   保持该状态持续COOL_DOWN时间（如30秒）。

3.  **HALF-OPEN（半开态）**：

    -   触发条件：COOL_DOWN计时结束。

    -   行为：允许且仅允许一个探测请求（Heartbeat Probe，如GET
        > STATUS）通过SE Adapter。

    -   若探测成功，切换回**CLOSED**状态，并在后台启动SE数据同步。

    -   若探测失败，切换回**OPEN**状态，并指数级增加下一次COOL_DOWN时间。

#### **4.2.2 仲裁逻辑代码实现（伪代码）**

C

// RCM 核心仲裁函数示例

Status RCM_ExecuteCrypto(Handle hSession, Command cmd, Data\* input,
Data\* output) {

// 1. 检查熔断器状态

if (CircuitBreaker_IsOpen(g_se_breaker)) {

LOG_WARN(\"SE Circuit Open, routing to TEE Backup\");

return TEE_Adapter_Execute(hSession, cmd, input, output);

}

// 2. 尝试通过SE执行

Status ret = SE_Adapter_Execute(hSession, cmd, input, output);

// 3. 错误处理与状态迁移

if (IsHardwareError(ret)) {

CircuitBreaker_RecordFailure(g_se_breaker);

if (CircuitBreaker_ShouldTrip(g_se_breaker)) {

CircuitBreaker_Trip(g_se_breaker);

LOG_ERROR(\"SE Failed! Switching to TEE immediately.\");

// 4. 故障转移重试

return TEE_Adapter_Execute(hSession, cmd, input, output);

}

} else if (ret == SUCCESS) {

CircuitBreaker_Reset(g_se_breaker);

}

return ret;

}

### **4.3 密钥同步与双重配置策略**

SE失效切换至TEE的核心难点在于**密钥的可用性**。出于安全原则，SE内部生成的私钥通常被标记为Non-Extractable（不可导出）。为了实现TEE备份，必须在密钥生命周期的**生成/注入阶段**介入。

#### **4.3.1 方案A：工厂模式下的双重注入（推荐）**

在产线EOL（End of Line）阶段，通过HMS（Hardware Security
Module）生成车辆根密钥对。

1.  **注入SE**：通过安全通道将密钥注入SE，并设置访问控制策略。

2.  **注入TEE**：同时将同一密钥注入TEE的RPMB或安全文件系统（SFS）。

    -   **加密保护**：注入TEE的密钥必须使用TEE的\*\*HUK（Hardware Unique
        > Key）\*\*进行加密封装（Key Wrapping）。

    -   **激活控制**：TEE中的密钥默认处于"休眠"或"备份"状态。只有当TEE
        > TA接收到来自RCM的"故障切换授权令牌"时，才解锁该密钥的使用权限。

#### **4.3.2 方案B：密钥派生与导入**

对于运行时生成的会话密钥（Session
Keys），RCM应优先在TEE中利用ECDH/Kyber协商生成，然后同步给SE（如果SE仅作为加速器）。若必须由SE生成，则需利用SE的Wrap
Key功能导出密文并在TEE中导入。但考虑到SE已故障，此方案仅适用于预防性同步，无法应对突发故障。因此，**方案A是满足高可用性的必选项**。

### **4.4 接口标准化封装：SDF与PKCS#11**

为了满足GB/T 32918和GB 44495的要求，RCM必须对外暴露标准接口。

#### **4.4.1 国密SDF接口封装**

根据GM/T 0018-2012及2023新标 ，RCM需实现以下关键函数：

-   SDF_OpenDevice(void \*\*phDeviceHandle):
    > 初始化RCM，建立与SE和TEE的连接池。

-   SDF_GenerateKeyWithKEK(\...): 在TEE中生成密钥，并用KEK加密导出备份。

-   SDF_InternalPrivateKeyOperation_RSA(\...):
    > 仲裁逻辑的核心入口，根据FSM状态选择执行引擎。

#### **4.4.2 PKCS#11 动态槽位映射**

对于Android/Linux应用，RCM实现为一个.so库。

-   **虚拟槽位（Virtual Slot）**：RCM向应用暴露Slot ID 0。

-   **动态绑定**：在内部，Slot 0 动态映射到 SE Token 或 TEE Token。

-   **异常屏蔽**：当SE拔出或无响应时，RCM捕获CKR_DEVICE_REMOVED错误
    > ，并不透传给上层应用，而是自动切换映射指针，使上层感知到的只是短暂的延迟而非服务中断。

## **5. 后量子密码（PQC）在TEE TA中的实施方案**

随着NIST正式发布FIPS 203 (ML-KEM/Kyber) 和 FIPS 204 (ML-DSA/Dilithium)
标准
，以及GB标准对未来安全性的隐含要求，车载系统引入PQC已刻不容缓。鉴于当前车规级SE（如Infineon
SLI9670, NXP
NCJ29D5）大多仅支持ECC/RSA硬件加速，且固件升级空间有限，**在TEE中通过软件实现PQC**是目前唯一可行的过渡方案。

### **5.1 算法选择与参数集**

针对车载嵌入式环境的资源限制（存储空间、总线带宽），建议采用以下参数集：

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **算法用途**   **推荐算法     **参数集**        **优势分析**                                                         **适用场景**
                 (NIST/ISO)**                                                                                          
  -------------- -------------- ----------------- -------------------------------------------------------------------- -------------------------------------------------
  **密钥封装     **Kyber        **Kyber-512**     密文仅768字节，安全性满足NIST Level 1 (AES-128等效)，性能与ECDH相当  V2X会话密钥协商、TLS 1.3握手、远程诊断连接。
  (KEM)**        (ML-KEM)**                       。                                                                   

  **数字签名**   **Dilithium    **Dilithium-2**   验签速度极快（优于ECDSA），适合实时性要求高的场景。签名尺寸约2.4KB   安全启动固件验签、OTA升级包验证、SOTA指令认证。
                 (ML-DSA)**                       。                                                                   
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

### **5.2 TEE可信应用（TA）的架构设计**

PQC算法的数学结构（格密码）主要涉及多项式运算和矩阵乘法，这与传统的大数模幂运算不同，需要针对性的软件架构。

#### **5.2.1 避免白盒，拥抱黑盒**

传统的白盒密码旨在恶劣环境（REE）中保护密钥，代价是巨大的性能损耗和代码膨胀。在TEE架构下，我们利用ARM
TrustZone的**Secure
EL1/EL0**隔离级别保护密钥内存。TA应当设计为**纯黑盒服务**：

-   密钥生成、存储、运算全在Secure RAM中完成。

-   REE仅持有Key Handle（句柄），无法触碰私钥明文。

-   这不仅符合"避免白盒"的要求，更将运算效率提升了两个数量级 。

#### **5.2.2 库的集成与静态链接**

推荐在TA中集成**wolfSSL**或**liboqs**的裁剪版本。由于TEE通常不支持动态链接库（.so），必须采用**静态链接（Static
Linking）** 。

-   **wolfSSL配置**：\
    > 针对Qualcomm/MTK的SDK环境，wolfSSL的编译配置建议如下：

./configure \--enable-static \--disable-shared

\--enable-kyber \--enable-dilithium \\ \# 启用PQC

\--enable-armasm \--enable-arm64 \\ \# 启用ARM汇编优化

\--user-settings \# 使用自定义头文件裁剪

\`\`\`

-   **user_settings.h 关键宏定义** ：

    -   #define
        > WOLFSSL_STATIC_MEMORY：启用静态内存管理，避免TEE内部malloc碎片化。

    -   #define NO_FILESYSTEM：TEE无标准文件系统，需适配TEE存储API。

    -   #define SINGLE_THREADED：若TA未配置多线程支持，减少锁开销。

### **5.3 内存管理与性能优化**

PQC算法对栈空间（Stack）的需求远大于ECC。例如，Kyber-512的密钥生成可能需要4-10KB的栈空间
。

#### **5.3.1 栈大小调整**

在QTEE或Kinibi的TA配置文件（如user_ta_header_defines.h或Manifest）中，必须显式增加栈大小：

-   **默认**：通常为2KB或4KB。

-   **PQC推荐**：**至少32KB** (TA_STACK_SIZE = 32 \* 1024)
    > 。若涉及Dilithium高安全等级，建议设为64KB。

#### **5.3.2 NEON指令集优化**

Qualcomm Snapdragon与MTK Dimensity芯片均搭载ARMv8/v9架构CPU，支持NEON
SIMD指令集。

-   **NTT优化**：数论变换（Number Theoretic
    > Transform）是格密码的核心瓶颈。利用NEON指令可并行处理多项式系数乘法。

-   **效果**：根据基准测试，开启NEON优化后，Cortex-A系列上的Kyber/Dilithium性能可提升**30%-50%**，能耗降低约40%
    > 。这对于车机在熄火状态下（低功耗模式）进行OTA验签至关重要。

### **5.4 GlobalPlatform API 扩展**

为了让REE侧的中间件能够调用PQC功能，需在GP TEE Internal Core
API的基础上扩展算法ID ：

C

// TEE_Extension_PQC.h

\#**define** TEE_ALG_KYBER_512_KEM 0xF0000001

\#**define** TEE_ALG_DILITHIUM_2 0xF0000002

// 扩展 TEE_OperationMode

\#**define** TEE_MODE_KEM_ENCAPSULATE 0xF1

\#**define** TEE_MODE_KEM_DECAPSULATE 0xF2

RCM中间件通过TEEC_InvokeCommand传递上述ID，TA内部解析并调用wolfSSL对应的wc_Kyber512_Encapsulate等函数。

## **6. TEE与SE的日志审计与异常关联**

GB
44495要求建立全面的网络安全监测体系。现有的日志系统往往忽略了底层安全硬件的异常，导致"沉默的失败"。本章节构建一套**统一安全审计架构**，重点解决TEE/SE日志的提取、防篡改与关联分析。

### **6.1 统一日志采集架构**

由于TEE和SE处于不同的隔离域，需要构建跨域的日志通道。

1.  **SE日志通道**：

    -   SE Driver（Kernel
        > Space）负责捕获每一次APDU交互的元数据（时间戳、CMD、SW1/SW2状态码、耗时）。

    -   通过**Netlink**或**DebugFS**将日志上报给用户空间的审计守护进程（Audit
        > Daemon）。

2.  **TEE日志通道**：

    -   **共享内存环形缓冲区（Shared Memory Ring Buffer）**：在Reserved
        > RAM中开辟一块区域，用于TEE OS输出日志 。

    -   **格式**：\[Payload\]。

    -   **读取**：REE侧的守护进程定期读取并清空缓冲区。

### **6.2 日志防篡改：哈希链（Hash Chaining）**

为满足审计日志的不可抵赖性，防止攻击者在入侵REE后删除或修改TEE上报的报警日志，我们引入区块链式的**哈希链技术**
。

-   **机制**：每一条日志 \$L_i\$ 的记录中包含上一条日志的哈希值
    > \$H\_{i-1}\$。\
    > \$\$H_i = \\text{SHA256}(L_i \\parallel H\_{i-1})\$\$

-   **锚点（Anchor）**：TEE每隔N条日志（或每分钟），使用其私钥对当前的哈希值
    > \$H_n\$ 进行数字签名，并将签名作为特殊的日志条目输出。

-   **验证**：审计系统可以重算哈希链并验证签名。如果中间任何一条日志被篡改或删除，链条将断裂，签名验证将失败。

### **6.3 异常关联分析与入侵检测**

Audit
Daemon不仅仅是搬运工，更是初级分析器。它将收集到的TEE和SE日志发送给AutoSAR
IdsM（Intrusion Detection System Manager），通过以下关联规则检测攻击：

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **攻击场景**          **TEE日志特征**          **SE日志特征**      **关联判定逻辑**                    **响应措施**
  --------------------- ------------------------ ------------------- ----------------------------------- ------------------------------------------------------------
  **SE总线干扰/屏蔽**   TEE TA启动加密服务       SE                  时间窗口(100ms)内：SE故障 + TEE接管 IdsM上报"硬件拒绝服务攻击"，云端标记车辆硬件异常。
                        (Backup Mode)            Driver报告连续I/O                                       
                                                 Timeout或CRC错误                                        

  **重放攻击/回滚**     RPMB Write Counter       无异常或SE正常      TEE报告防回滚校验失败               立即锁定关键密钥，禁止执行高权限操作，上报"固件回滚攻击"。
                        Mismatch                                                                         

  **侧信道/故障注入**   异常复位，内存校验错误   SE响应异常状态码    短时间内高频的TEE复位或SE鉴权失败   触发"Panic Mode"，清除缓存敏感数据，记录攻击指纹。
                                                 (如69 82)                                               
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------

## **7. MediaTek (MTK) RPMB 单点故障问题与缓解方案**

MediaTek平台在处理RPMB时，历史上存在一些特定的稳定性挑战，且eMMC的物理特性决定了RPMB是一个"磨损即死"的单点。一旦RPMB分区损坏或密钥不同步，设备将无法通过安全启动，导致车辆ECU"变砖"。

### **7.1 问题根源分析**

RPMB（Replay Protected Memory Block）依靠一个共享密钥（RPMB
Key）和单调计数器（Write Counter）来防止重放。

-   **单点风险**：密钥只写入一次（One-Time Programmable,
    > OTP）。如果eMMC控制器逻辑错误导致密钥状态位翻转，或者计数器达到最大值，或者Flash物理单元损坏，TEE将永久失去对防回滚数据的读写能力
    > 。

-   **MTK特异性**：部分MTK
    > SDK在量产前使用软件模拟RPMB（Soft-RPMB），如果在量产时未正确熔断eFuse强制硬件RPMB，可能导致安全漏洞；反之，若硬件RPMB不稳定，则缺乏回退路径
    > 。

### **7.2 解决方案：混合存储镜像（Hybrid Storage Mirroring）**

我们提出一种\*\*"主备同步 +
云端仲裁"\*\*的混合架构，在不牺牲安全性的前提下提供可用性兜底。

#### **7.2.1 架构设计**

1.  **Primary Storage
    > (RPMB)**：依然作为首选存储，保存防回滚计数器和密钥哈希。

2.  **Mirror Storage (REE FS)**：在普通的User
    > Data分区（ext4/f2fs）创建一个镜像文件（如/data/tee/rpmb_mirror.bin）。

3.  **安全封装**：

    -   镜像文件必须由TEE使用\*\*HUK（芯片唯一密钥）\*\*进行AES-GCM加密。

    -   镜像文件头部包含一个由TEE签名的**版本号（Version Epoch）**。

#### **7.2.2 读写策略（原子性保障）**

-   **写操作**：

    1.  TEE先更新RPMB。

    2.  若RPMB写入成功，立即更新REE Mirror。

    3.  若RPMB写入失败（硬件故障），记录错误标记，强制更新REE
        > Mirror，并进入"RPMB失效模式"。

-   **读操作（恢复逻辑）**：

    1.  TEE尝试读取RPMB。

    2.  若RPMB返回I/O错误（非鉴权失败，而是设备无响应），TEE转向读取REE
        > Mirror。

    3.  **安全性挑战**：REE Mirror可能被旧文件替换（回滚攻击）。

    4.  **云端仲裁（GB/T 32960合规利用）**：

        -   车辆利用T-BOX连接OEM云端（符合GB 32960远程连接要求）。

        -   TEE生成一个包含当前Mirror版本号的挑战请求。

        -   云端记录了车辆上一次成功上报的合法版本号。

        -   云端下发"状态确认令牌"。

        -   TEE验证令牌后，信任REE Mirror的数据，恢复系统启动。

此方案将RPMB的单点故障风险转移到了"REE存储+云端连接"的组合上。鉴于车辆通常具备联网能力，且GB
32960要求实时监控，这种依赖是可接受的，并显著降低了因存储芯片物理损坏导致的召回风险
。

## **8. 结论与建议**

本报告针对Qualcomm和MediaTek车载平台，提出了一套综合性的安全增强架构。

1.  **中间件层面**：通过引入包含**熔断器模式**的RCM中间件，实现了SE与TEE的优势互补。SE提供高物理安全，TEE提供高可用性备份，彻底解决了硬件单点故障导致车辆停摆的风险。

2.  **算法层面**：在TEE中静态集成优化后的**wolfSSL
    > PQC库**，利用Kyber和Dilithium算法构建了后量子时代的防御屏障，规避了硬件SE算法固化的缺陷。

3.  **审计层面**：构建了**哈希链日志系统**，确保了安全事件的不可篡改与可追溯性，满足GB
    > 44495的合规要求。

4.  **存储层面**：通过**混合存储镜像与云端仲裁**，有效化解了MTK平台RPMB的不稳定性风险。

**建议实施路线图**：

-   **阶段一（2026
    > Q1）**：完成RCM中间件开发，实现SDF接口封装与SE/TEE的基础切换逻辑；在开发板上验证wolfSSL
    > PQC算法的NEON优化性能。

-   **阶段二（2026 Q3）**：集成AutoSAR
    > IdsM，打通TEE日志上报链路；完成RPMB云端仲裁协议的定义与后端开发。

-   **阶段三（2027
    > SOP）**：全系统集成测试，重点进行故障注入测试（物理断开SE、干扰RPMB读写），确保故障恢复机制符合功能安全ASIL等级要求。

通过实施上述方案，OEM厂商不仅能够满足当前严苛的法规要求，更能构建起具备长期生命力的弹性安全架构。
